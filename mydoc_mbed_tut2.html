<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content="tutorials,  ">
<title>BLE Beacons | VBLUno51 board</title>
<link rel="stylesheet" href="css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<link rel="stylesheet" href="css/lavish-bootstrap.css">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/theme-orange.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/vbluno2_small.png">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });
            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });
            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });
        });
    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">

        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            
                        
            <img src="images/pic_topnav.png" alt="VBLUno51 board">
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> VBLUno51 - VNG Bluetooth Low Energy UNO nRF51822 - IoT development board</span>            
            
            </a>
        </div>

        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i></a></li>
                <!-- entries without drop-downs appear here -->
                                                    
                                
                    
                    
                    <li><a href="news">News</a></li>
                    
                    
                                        
                               
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                    
                    
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Resources<b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
                            
                            <li><a href="https://goo.gl/bISeQl" target="_blank">VBLUno51 on Facebook</a></li>
                            
                            
                            
                            <li><a href="https://goo.gl/w8gQHT" target="_blank">VBLUno51 on store</a></li>
                            
                            
                            
                            <li><a href="https://goo.gl/kpLmQs" target="_blank">DAPLink (CMSIS-DAP) interface</a></li>
                            
                            
                            
                            <li><a href="https://goo.gl/1nj0LZ" target="_blank">VBLUno on Arduino.vn forum</a></li>
                            
                            
                        </ul>
                    </li>
                    
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">SDK & OS Supports<b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
                            
                            <li><a href="mydoc_getstart_arduino.html">Arduino IDE</a></li>
                            
                            
                            
                            <li><a href="mydoc_getstart_mbed.html">mbed-OS</a></li>
                            
                            
                            
                            <li><a href="mydoc_getstart_mynewt.html">Apache Mynewt-OS</a></li>
                            
                            
                            
                            <li><a href="mydoc_getstart_zephyr.html">Zephyr</a></li>
                            
                            
                            
                            <li><a href="mydoc_getstart_riot.html">RIOT-OS</a></li>
                            
                            
                            
                            <li><a href="mydoc_getstart_nordicsdk.html">Nordic SDK</a></li>
                            
                            
                        </ul>
                    </li>
                    
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Feedback<b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
                            
                            <li><a href="https://github.com/VNGIoTLab/vbluno/issues" target="_blank">Github issues tracker</a></li>
                            
                            
                            
                            <li><a href="https://www.facebook.com/bleviet/messages" target="_blank">Send Facebook messages</a></li>
                            
                            
                        </ul>
                    </li>
                    
                    
                    <li><a class="link-vi" href="/vbluno/vi/index_vi.html">TIẾNG VIỆT</a></li>
                
                

                <!--comment out this block if you want to hide search-->
                <li>
                
                    <!--start search-->
                    <div id="search-demo-container">                    
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>

                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="BLE Beacons">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                

                </li>                
            </ul>    

        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
    <div class="col-lg-12">&nbsp;</div>
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                

<ul id="mysidebar" class="nav">
    <li class="sidebarTitle">VBLUno51 board </li>
    
    
            
        
    
    <li>
        <a href="#">Overview</a>
        <ul>
            

            

            
            
            
            <li><a href="mydoc_introduction.html">Introduction</a></li>
            
            
            

            


            
            
            
            
            <li><a href="mydoc_over_hardware.html">Note about the hardware versions (important)</a></li>
            
            
            

            


            
            
            
            
            <li><a href="mydoc_over_sdk.html">Software Development Kit</a></li>
            
            
            

            


            
            
            
            
            <li><a href="mydoc_over_appcanmake.html">What applications can you make with VBLUno51?</a></li>
            
            
            

            


            
            
        </ul>
    </li>
                
        
    
    <li>
        <a href="#">Documents</a>
        <ul>
            

            

            
            
            
            <li><a href="https://goo.gl/HUdV1Q" target="_blank">Nordic nRF51822 specification</a></li>
            
            
            

            


            
            
            
            
            <li><a href="https://goo.gl/byqaK0" target="_blank">Schematic</a></li>
            
            
            

            


            
            
            
            
            <li><a href="mydoc_doc_pinout.html">Pinout</a></li>
            
            
            

            


            
            
            
            
            <li><a href="mydoc_doc_fritzing.html">Fritzing Part</a></li>
            
            
            

            


            
            
            
            
            <li><a href="https://goo.gl/oVdvcv" target="_blank">mbed Serial driver (Only Windows)</a></li>
            
            
            

            


            
            
        </ul>
    </li>
                
        
    
    <li>
        <a href="#">Getting Start</a>
        <ul>
            

            

            
            
            
            <li><a href="mydoc_getstart_arduino.html">Using Arduino IDE</a></li>
            
            
            
            
            <li class="subfolders">
                <a href="#">Using mbed-OS</a>
                <ul>
                    
                    
                    
                    <li><a href="mydoc_getstart_mbedonline.html">mbed Online Compiler</a></li>
                    
                    
                    
                    
                    
                    <li><a href="mydoc_getstart_gnuarm_eclipse.html">GNU ARM Embedded & Eclipse IDE (recommend)</a></li>
                    
                    
                    
                    
                    
                    <li><a href="mydoc_getstart_keil.html">Keil uVision</a></li>
                    
                    
                    
                </ul>
            </li>
            
            

            


            
            
        </ul>
    </li>
                
        
    
    <li>
        <a href="#">Bluetooth Low Energy (BLE)</a>
        <ul>
            

            

            
            
            
            <li><a href="mydoc_ble.html">Introduction to Bluetooth Low Energy</a></li>
            
            
            

            


            
            
            
            
            <li><a href="https://goo.gl/5q7jC4" target="_blank">BLE manual for mbed-OS</a></li>
            
            
            

            


            
            
        </ul>
    </li>
                
        
    
    <li>
        <a href="#">Tutorials</a>
        <ul>
            
            
            <li class="subfolders">
                <a href="#">Adruino</a>
                <ul>
                    
                    
                    
                    <li><a href="mydoc_arduino_tut1.html">Tut1 - Heart rate monitor device (HRM) with VBLUno51</a></li>
                    
                    
                    
                    
                    
                    <li><a href="mydoc_arduino_tut2.html">Tut2 - iBeacons device with VBLUno51</a></li>
                    
                    
                    
                    
                    
                    <li><a href="mydoc_arduino_tut3.html">Tut3 - Measure the temperature inside nRF51822 (SoC)</a></li>
                    
                    
                    
                    
                    
                    <li><a href="mydoc_arduino_tut4.html">Tut4 - Health thermometer with VBLUno (HTM)</a></li>
                    
                    
                    
                    
                    
                    <li><a href="mydoc_arduino_tut5.html">Tut5 - Communicate between smartphone and PC by “UART over BLE”</a></li>
                    
                    
                    
                    
                    
                    <li><a href="mydoc_arduino_tut6.html">Tut6 - Controlling/monitoring a device by Smartphone over BLE</a></li>
                    
                    
                    
                </ul>
            </li>
            
            

            
            
            <li class="subfolders">
                <a href="#">mbed-OS</a>
                <ul>
                    
                    
                    
                    <li><a href="mydoc_mbed_tut1.html">Tut1 - Program/debug for VBLUno by pyOCD and OpenOCD on GNU ARM Embedded + Eclipse</a></li>
                    
                    
                    
                    
                    
                    <li class="active"><a href="mydoc_mbed_tut2.html">Tut2 - BLE Beacons</a></li>
                    
                    
                    
                </ul>
            </li>
            
            

            
        </ul>
    </li>
                
        
    
    <li>
        <a href="#">Code Examples</a>
        <ul>
            

            

            
            
            
            <li><a href="mydoc_code_arduino.html">Arduino</a></li>
            
            
            

            


            
            
            
            
            <li><a href="mydoc_code_mbed.html">mbed-OS</a></li>
            
            
            

            


            
            
        </ul>
    </li>
                
        
    
    <li>
        <a href="#">Video</a>
        <ul>
            

            

            
            
            
            <li><a href="https://goo.gl/Vi0mpo" target="_blank">BLE Serial application</a></li>
            
            
            

            


            
            
            
            
            <li><a href="https://goo.gl/01X4oM" target="_blank">Controlling a robot over BLE with VBLUno</a></li>
            
            
            

            


            
            
        </ul>
    </li>
                
        
    
    <li>
        <a href="#">Mobile applications for BLE</a>
        <ul>
            

            

            
            
            
            <li><a href="https://goo.gl/i6DNtP" target="_blank">iBeacon & Eddystone Scanner (Android)</a></li>
            
            
            
            
            <li class="subfolders">
                <a href="#">Nordic nRF Toolbox</a>
                <ul>
                    
                    
                    
                    <li><a href="https://goo.gl/s3fbVW" target="_blank">Android</a></li>
                    
                    
                    
                    
                    
                    <li><a href="https://goo.gl/GH8gom" target="_blank">iOS</a></li>
                    
                    
                    
                </ul>
            </li>
            
            

            


            
            
            
            
            <li><a href="https://goo.gl/sFbubD" target="_blank">nRF UART 2.0 (Android)</a></li>
            
            
            
            
            <li class="subfolders">
                <a href="#">Open source softwares</a>
                <ul>
                    
                    
                    
                    <li><a href="https://goo.gl/Et1atP" target="_blank">Nordic nRFToolbox (Android)</a></li>
                    
                    
                    
                    
                    
                    <li><a href="https://goo.gl/rdTll8" target="_blank">BluetoohLeGatt Example (Android)</a></li>
                    
                    
                    
                </ul>
            </li>
            
            

            


            
            
        </ul>
    </li>
                
        
    
    <li>
        <a href="#">Links</a>
        <ul>
            

            

            
            
            
            <li><a href="http://iotviet.com.vn" target="_blank">IoT Vietnam Store</a></li>
            
            
            

            


            
            
            
            
            <li><a href="https://goo.gl/YCxUeK" target="_blank">CSM Router (VNG)</a></li>
            
            
            

            


            
            
            
            
            <li><a href="https://zalopay.vn" target="_blank">ZaloPay – (Auto payment application)</a></li>
            
            
            

            


            
            
            
            
            <li><a href="https://www.facebook.com/groups/iotalliancevn/" target="_blank">Vietnam IoT Alliance page</a></li>
            
            
            

            


            
            
            
            
            <li><a href="https://developer.mbed.org/" target="_blank">ARM mbed  OS developer site</a></li>
            
            
            

            


            
            
        </ul>
    </li>
                
        
    
    <li>
        <a href="#">About</a>
        <ul>
            

            

            
            
            
            <li><a href="https://goo.gl/c3sbnk" target="_blank">Contact our store</a></li>
            
            
            

            


            
            
            
            
            <li><a href="https://www.facebook.com/bleviet/" target="_blank">Bluetooth Low Energy – BLE Vietnam page</a></li>
            
            
            

            


            
            
        </ul>
    </li>
                
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->    
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            <div class="post-header">
   <h1 class="post-title-main">BLE Beacons</h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->



	<script>
	$( document ).ready(function() {
	  // Handler for .ready() called.

	$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

	/* this offset helps account for the space taken up by the floating toolbar. */
	$('#toc').on('click', 'a', function() {
	  var target = $(this.getAttribute('href'))
	    , scroll_target = target.offset().top

	  $(window).scrollTop(scroll_target - 10);
	  return false
	})
	  
	});
	</script>

	<div id="toc"></div>



    


    

    <a target="_blank" href="https://github.com/VNGIoTLab/vbluno/tree/master/pages/mydoc/mydoc_mbed_tut2.md" class="btn btn-default githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit me</a>

    

  <h1 id="sỬ-dỤng-mbed-os-ĐỂ-lẬp-trÌnh-thiẾt-bỊ-phÁt-beacons-vỚi-vbluno-v2">SỬ DỤNG MBED-OS ĐỂ LẬP TRÌNH THIẾT BỊ PHÁT BEACONS VỚI VBLUNO V2</h1>

<hr />
<h2 id="giới-thiệu-công-nghệ-beacons">Giới thiệu công nghệ Beacons</h2>

<p>Bạn có thể tham khảo Tut 2  trong loạt bài <code class="highlighter-rouge">Tutorials --&gt; Arduino --&gt; Tut2</code> và bài viết tại các link sau:</p>

<p>https://developer.mbed.org/teams/Bluetooth-Low-Energy/code/BLE_iBeacon/?platform=Nordic-nRF51822</p>

<p>http://www.havlena.net/en/location-technologies/ibeacons-how-do-they-technically-work/</p>

<p>http://www.warski.org/blog/2014/01/how-ibeacons-work/</p>

<p><img src="images/mbed/tut/tut2/1.png" alt="" /></p>

<hr />
<h2 id="thực-hiện-ví-dụ-minh-họa-ibeacon-trên-vbluno-v2-sử-dụng-mbed-os">Thực hiện ví dụ minh họa iBeacon trên VBLUno v2 sử dụng mbed-OS</h2>

<ul>
  <li><strong>Bước 1</strong>: Tham khảo mã nguồn chương trình</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>#include "mbed.h"
#include "ble/services/iBeacon.h"

BLE ble;
    
void bleInitComplete(BLE::InitializationCompleteCallbackContext *params)
{
    BLE &amp;ble          = params-&gt;ble;
    ble_error_t error = params-&gt;error;

    if (error != BLE_ERROR_NONE) {
        return;
    }
    
    /**
     * The Beacon payload has the following composition:
     * 128-Bit / 16byte UUID = E2 0A 39 F4 73 F5 4B C4 A1 2F 17 D1 AD 07 A9 61
     * Major/Minor  = 0x1122 / 0x3344
     * Tx Power     = 0xC8 = 200, 2's compliment is 256-200 = (-56dB)
     *
     * Note: please remember to calibrate your beacons TX Power for more accurate results.
     */
    const uint8_t uuid[] = {0xE2, 0x0A, 0x39, 0xF4, 0x73, 0xF5, 0x4B, 0xC4,
                            0xA1, 0x2F, 0x17, 0xD1, 0xAD, 0x07, 0xA9, 0x61};
    uint16_t majorNumber = 1122;
    uint16_t minorNumber = 3344;
    uint16_t txPower     = 0xC8;
    iBeacon *ibeacon = new iBeacon(ble, uuid, majorNumber, minorNumber, txPower);

    ble.gap().setAdvertisingInterval(1000); /* 1000ms. */
    ble.gap().startAdvertising();
}

int main(void)
{
    ble.init(bleInitComplete);
    
    /* SpinWait for initialization to complete. This is necessary because the
     * BLE object is used in the main loop below. */
    while (!ble.hasInitialized()) { /* spin loop */ }

    while (true) {
        ble.waitForEvent(); // allows or low power operation
    }
}
</code></pre>
</div>

<ul>
  <li>
    <p><strong>Bước 2</strong>: Biên dịch và chạy thử</p>
  </li>
  <li>
    <p>Sau khi biên dịch và nạp chương trình cho mạch VBLUno, chương trình tự động được chạy. Để kiểm tra bạn cần sử dụng một thiết bị hỗ trợ BLE. Ở đây mình sử dụng phần mềm Beacons Scanner chạy trên điện thoại Android  để kiểm tra</p>
  </li>
  <li>
    <p>Kết quả kiểm tra cho thấy mạch VBLUno của chúng ta đã phát Beacons. Các thông số mà điện thoại thu được như trong hình dưới đây</p>
  </li>
</ul>

<p><img src="images/mbed/tut/tut2/2.png" alt="" /></p>

<ul>
  <li><strong>Bước 3</strong>: Tìm hiểu các hàm API  trong ví dụ trên</li>
</ul>

<p>Trong ví dụ trên có sử dụng thư viện iBeacons của mbed. Công việc đơn giản chỉ là khởi tạo các tham số iBeacons mà chúng ta cần phát, rồi sau đó tiến hành phát BLE ra môi trường.</p>

<p>Trong code có ghi chú khá rõ ràng, hy vọng sẽ không gây khó khăn cho  các bạn trong việc đọc hiểu nó.</p>

<p>Có thể thấy, với VBLUno bạn có thể dễ dàng chế tạo một thiết bị phát beacons. Bạn có thể thử sức mình với bài toán nâng cao độ chính xác trong việc xác định khoảng cách đến thiết bị phát beacons.</p>

<ul>
  <li>Mọi thắc mắc hoặc ý kiến đóng góp bạn có thể trao đổi tại đây:</li>
</ul>

<p>https://www.facebook.com/bleviet/messages/</p>

<p>https://github.com/VNGIoTLab/mbed_for_VBLUno-CMSIS-DAP/issues</p>


    <div class="tags">
        
        <b>Tags: </b>
        
        
        
        <a href="tag_tutorials.html" class="btn btn-default navbar-btn cursorNorm" role="button">tutorials</a>
        
        
        
    </div>

    

</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2017 VNG Corporation. All rights reserved. <br />
 Site last generated: May 24, 2017 <br />
<p><img src="images/company_logo_medium.png" alt="Company logo"/></p>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
    </div>

</body>

</html>